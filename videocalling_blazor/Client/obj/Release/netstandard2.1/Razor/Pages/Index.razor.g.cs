#pragma checksum "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "18a0046e451996fe1e7ceed726cf4a00998fe2e5"
// <auto-generated/>
#pragma warning disable 1591
namespace videocalling_blazor.Client.Pages
{
    #line hidden
#nullable restore
#line 3 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\_Imports.razor"
using videocalling_blazor.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\_Imports.razor"
using videocalling_blazor.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using videocalling_blazor.Client.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using Microsoft.AspNetCore.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using Microsoft.AspNetCore.SignalR.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using Microsoft.Extensions.DependencyInjection;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using System;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using System.Collections.Generic;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using System.Linq;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using System.Threading.Tasks;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using videocalling_blazor.Client.Interop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using videocalling_blazor.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using System.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/")]
    public partial class Index : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 23 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
 if (_isloader == true)
{

#line default
#line hidden
#nullable disable
            __builder.AddContent(0, "    ");
            __builder.AddMarkupContent(1, "<div class=\"loadingdiv\">\r\n        <div class=\"spinner\"></div>\r\n    </div>\r\n");
#nullable restore
#line 28 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
}

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(2, "\r\n");
            __builder.OpenElement(3, "div");
            __builder.AddAttribute(4, "class", "container-fluid");
            __builder.AddMarkupContent(5, "\r\n    ");
            __builder.OpenElement(6, "div");
            __builder.AddAttribute(7, "class", "row h-100");
            __builder.AddMarkupContent(8, "\r\n        ");
            __builder.OpenElement(9, "div");
            __builder.AddAttribute(10, "class", "col-12");
            __builder.AddMarkupContent(11, "\r\n            ");
            __builder.OpenElement(12, "div");
            __builder.AddAttribute(13, "class", "row banner");
            __builder.AddMarkupContent(14, "\r\n                ");
            __builder.OpenElement(15, "div");
            __builder.AddAttribute(16, "class", "col-12");
            __builder.AddMarkupContent(17, "\r\n                    ");
            __builder.OpenElement(18, "div");
            __builder.AddAttribute(19, "class", "row");
            __builder.AddMarkupContent(20, "\r\n                        ");
            __builder.OpenElement(21, "div");
            __builder.AddAttribute(22, "class", "col-md-6 col-lg-6 col-sm-12");
            __builder.AddMarkupContent(23, "\r\n                            <img src=\"/images/SoowGood-Logo.png\" class=\"logo_sooWGood\">\r\n\r\n                            ");
            __builder.OpenElement(24, "h4");
#nullable restore
#line 39 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
__builder.AddContent(25, _testroomName);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(26, "\r\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(27, "\r\n                        ");
            __builder.OpenElement(28, "div");
            __builder.AddAttribute(29, "class", "col-md-6 col-lg-6 col-sm-12");
            __builder.AddAttribute(30, "style", "padding-bottom: 10px;padding-top: 20px;");
            __builder.AddMarkupContent(31, "\r\n\r\n");
#nullable restore
#line 43 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                             if (_activeRoom != null)
                            {


#line default
#line hidden
#nullable disable
            __builder.AddContent(32, "                                ");
            __builder.OpenElement(33, "div");
            __builder.AddAttribute(34, "style", "text-align:center");
            __builder.AddMarkupContent(35, "\r\n");
#nullable restore
#line 47 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                     if (_isAudioOn == "")
                                    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(36, "                                        ");
            __builder.OpenElement(37, "button");
            __builder.AddAttribute(38, "class", "btn btn-lg twilio-btn-blue");
            __builder.AddAttribute(39, "style", "margin-right:20px");
            __builder.AddAttribute(40, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 49 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                                                                                                         async _ => await OnUnMuteandMuteAudioRoom(true)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(41, "\r\n                                            <i class=\"fas fa-microphone\" aria-label=\"Join room\"></i>\r\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(42, "\r\n");
#nullable restore
#line 52 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                    }
                                    else
                                    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(43, "                                        ");
            __builder.OpenElement(44, "button");
            __builder.AddAttribute(45, "class", "btn btn-lg twilio-btn-red");
            __builder.AddAttribute(46, "style", "margin-right:20px");
            __builder.AddAttribute(47, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 55 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                                                                                                        async _ => await OnUnMuteandMuteAudioRoom(false)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(48, "\r\n                                            <i class=\"fas fa-microphone-slash\" aria-label=\"Join room\"></i>\r\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(49, "\r\n");
#nullable restore
#line 58 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                    }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(50, "\r\n\r\n\r\n\r\n");
#nullable restore
#line 63 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                     if (_isCammeraOn == "")
                                    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(51, "                                        ");
            __builder.OpenElement(52, "button");
            __builder.AddAttribute(53, "class", "btn btn-lg twilio-btn-blue");
            __builder.AddAttribute(54, "style", "margin-right:20px");
            __builder.AddAttribute(55, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 65 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                                                                                                         async _ => await OnUnMuteandMuteVideoRoom(true)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(56, "\r\n                                            <i class=\"fas fa-video\" aria-label=\"Join room\"></i>\r\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(57, "\r\n");
#nullable restore
#line 68 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                    }
                                    else
                                    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(58, "                                        ");
            __builder.OpenElement(59, "button");
            __builder.AddAttribute(60, "class", "btn btn-lg twilio-btn-red");
            __builder.AddAttribute(61, "style", "margin-right:20px");
            __builder.AddAttribute(62, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 71 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                                                                                                        async _ => await OnUnMuteandMuteVideoRoom(false)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(63, "\r\n                                            <i class=\"fas fa-video-slash\" aria-label=\"Join room\"></i>\r\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(64, "\r\n");
#nullable restore
#line 74 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                    }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(65, "\r\n                                    ");
            __builder.OpenElement(66, "button");
            __builder.AddAttribute(67, "class", "btn btn-lg twilio-btn-red");
            __builder.AddAttribute(68, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 76 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                                                                          async _ => await OnLeaveRoom()

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(69, "\r\n                                        <i class=\"fas fa-phone\" style=\"-ms-transform: rotate(230deg);-webkit-transform: rotate(230deg);transform: rotate(230deg);\" aria-label=\"Join room\"></i>\r\n                                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(70, "\r\n                                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(71, "\r\n");
#nullable restore
#line 80 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                            }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(72, "\r\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(73, "\r\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(74, "\r\n                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(75, "\r\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(76, "\r\n");
#nullable restore
#line 86 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
             if (_activeRoom == null)
            {

#line default
#line hidden
#nullable disable
            __builder.AddContent(77, "                ");
            __builder.OpenElement(78, "div");
            __builder.AddAttribute(79, "class", "row");
            __builder.AddMarkupContent(80, "\r\n                    ");
            __builder.OpenElement(81, "div");
            __builder.AddAttribute(82, "class", "col-md-6 col-lg-6 offset-lg-3 offset-md-3 col-sm-12");
            __builder.AddMarkupContent(83, "\r\n                        ");
            __builder.OpenElement(84, "div");
            __builder.AddAttribute(85, "class", "jumbotron p-4");
            __builder.AddMarkupContent(86, "\r\n                            ");
            __builder.OpenElement(87, "div");
            __builder.AddAttribute(88, "class", "row");
            __builder.AddMarkupContent(89, "\r\n                                ");
            __builder.OpenElement(90, "div");
            __builder.AddAttribute(91, "class", "col-md-12 col-lg-12 col-sm-12");
            __builder.AddAttribute(92, "style", "margin-bottom:5px;");
            __builder.AddMarkupContent(93, "\r\n                                    ");
            __builder.OpenComponent<videocalling_blazor.Client.Components.Cameras>(94);
            __builder.AddAttribute(95, "CameraChanged", global::Microsoft.AspNetCore.Components.CompilerServices.RuntimeHelpers.TypeCheck<Microsoft.AspNetCore.Components.EventCallback<System.String>>(Microsoft.AspNetCore.Components.EventCallback.Factory.Create<System.String>(this, 
#nullable restore
#line 93 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                                            OnCameraChanged

#line default
#line hidden
#nullable disable
            )));
            __builder.CloseComponent();
            __builder.AddMarkupContent(96, "\r\n                                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(97, "\r\n                                ");
            __builder.OpenElement(98, "div");
            __builder.AddAttribute(99, "class", "col-md-12 col-lg-12 col-sm-12");
            __builder.AddAttribute(100, "style", "text-align:center;");
            __builder.AddMarkupContent(101, "\r\n\r\n                                    ");
            __builder.OpenElement(102, "div");
            __builder.AddAttribute(103, "style", "text-align:center;");
            __builder.AddMarkupContent(104, "\r\n                                        ");
            __builder.OpenElement(105, "button");
            __builder.AddAttribute(106, "class", "btn btn-lg twilio-btn-blue");
            __builder.AddAttribute(107, "disabled", 
#nullable restore
#line 99 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                                            _activeCamera is null

#line default
#line hidden
#nullable disable
            );
            __builder.AddAttribute(108, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 100 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                                                            async args => await TryAddRoom(args)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(109, "\r\n                                            <i class=\"fa fa-phone-alt\" aria-label=\"Join room\"></i>\r\n                                            Connect\r\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(110, "\r\n                                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(111, "\r\n                                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(112, "\r\n                            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(113, "\r\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(114, "\r\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(115, "\r\n                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(116, "\r\n");
#nullable restore
#line 110 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
            }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(117, "\r\n\r\n\r\n            ");
            __builder.AddMarkupContent(118, @"<div class=""row embed-responsive-participant"">
                <div class=""col-12"">
                    <div id=""participants"" class=""participants-grid"">
                        <div class=""embed-responsive embed-responsive-16by9 initiatecall"">
                            <div id=""camera"" class=""embed-responsive-item""></div>
                        </div>
                    </div>
                </div>
            </div>





");
#nullable restore
#line 128 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
             foreach (var room in _rooms!)
            {

                

#line default
#line hidden
#nullable disable
#nullable restore
#line 131 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                 if (room.ParticipantCount != room.MaxParticipants)
                {

#line default
#line hidden
#nullable disable
            __builder.AddContent(119, "                    ");
            __builder.AddMarkupContent(120, @"<div class=""row paticipentloaderbeforejoin"">
                        
                        <div class=""col-12 beforejoin"">
                             <div class=""spinner1""></div>
                            Wait till other participant will join in this call
                        </div>
                    </div>
");
#nullable restore
#line 140 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                }

#line default
#line hidden
#nullable disable
#nullable restore
#line 140 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
                 


            }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(121, "\r\n\r\n\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(122, "\r\n\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(123, "\r\n");
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 152 "E:\OfficeData\angular_workspace\soowgood\videocalling_blazor\Client\Pages\Index.razor"
       

    [Parameter]
    public string? _room { get; set; }
    [Inject]
    protected IJSRuntime? JavaScript { get; set; }
    [Inject]
    protected NavigationManager NavigationManager { get; set; } = null!;
    [Inject]
    protected HttpClient Http { get; set; } = null!;

    List<RoomDetails> _rooms = new List<RoomDetails>();

    string? _testroomName;
    string? _roomName;
    string? _activeCamera;
    string? _activeRoom;
    string? _bookingid;
    string? _serviceforname;
    string? _usertype;
    string? _username;

    HubConnection? _hubConnection;
    bool? _isloader = false;

    string? _isCammeraOn = "";
    string? _isAudioOn = "";



    protected override async Task OnInitializedAsync()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        //if (QueryHelpers.ParseQuery(uri.Query).TryGetValue("_room", out var _rName))
        //{
        //    _testroomName = _rName;
        //}

        var data = HttpUtility.ParseQueryString(new Uri(NavigationManager.Uri).Query);
        if (data["_data"] == null)
        {
            NavigationManager.NavigateTo("errorpage?code=404");
        }
        else
        {
            _isloader = true;
            _bookingid = data["_data"];
            _usertype = data["_usertype"];
            await GetAppointDetailsForCall(_bookingid, _usertype);
        }

    }


    async ValueTask OnUnMuteandMuteVideoRoom(bool cammerastatus)
    {
        await JavaScript.UnMuteandMuteVideoRoomAsync(_testroomName, cammerastatus);
        if (cammerastatus == true)
        {
            _isCammeraOn = "inactive";
        }
        else
        {
            _isCammeraOn = "";
        }
    }


    async ValueTask OnUnMuteandMuteAudioRoom(bool cammerastatus)
    {
        await JavaScript.UnMuteandMuteAudioRoomAsync(_testroomName, cammerastatus);
        if (cammerastatus == true)
        {
            _isAudioOn = "inactive";
        }
        else
        {
            _isAudioOn = "";
        }
    }





    async ValueTask OnLeaveRoom()
    {
        await JavaScript.LeaveRoomAsync();
        _activeRoom = null;
        if (!string.IsNullOrWhiteSpace(_activeCamera))
            //await JavaScript.StartVideoAsync(_activeCamera, "#camera");
            NavigationManager.NavigateTo("/leavemeeting?_data=" + _bookingid + "&_usertype=" + _usertype, forceLoad: true);


    }

    async Task OnCameraChanged(string activeCamera) =>
        await InvokeAsync(() => _activeCamera = activeCamera);

    async Task OnRoomAdded(string roomName) =>
        await InvokeAsync(async () =>
        {
            _rooms = await Http.GetFromJsonAsync<List<RoomDetails>>("api/twilio/rooms");
            StateHasChanged();
        });

    protected async ValueTask TryAddRoom(object args)
    {
        _isloader = true;
        if (_testroomName is null || _testroomName is { Length: 0 })
        {
            _isloader = false;
            return;
        }
        else
        {

            _roomName = _testroomName;
        }

        var takeAction = args switch
        {
            KeyboardEventArgs keyboard when keyboard.Key == "Enter" => true,
            MouseEventArgs _ => true,
            _ => false
        };

        if (takeAction)
        {
            var addedOrJoined = await TryJoinRoom(_roomName, _serviceforname, _username);
            if (addedOrJoined)
            {
                await JavaScript.JoinRoomSuccessAsync();
                await OnRoomAdded(_roomName);
                //await sendnotificationatcallstarted(_bookingid, _usertype);
                _isloader = false;
                _roomName = null;
            }
            else
            {
                _isloader = false;
            }
        }
    }





    protected async ValueTask<bool> sendnotificationatcallstarted(string? bookingid, string? usertype)
    {
        if (bookingid is null || bookingid is { Length: 0 })
        {
            return false;
        }
        var postBody = new BookData { Id = bookingid, usertype= usertype };
        var bookingdata = await Http.PostAsJsonAsync("api/appointment/sendnotificationatcallstarted", postBody);
        string apiResponse = await bookingdata.Content.ReadAsStringAsync();
        List<BookData> response = JsonConvert.DeserializeObject<List<BookData>>(apiResponse);

        return true;


    }


    protected async ValueTask<bool> GetAppointDetailsForCall(string? bookingid, string? usertype)
    {
        if (bookingid is null || bookingid is { Length: 0 })
        {
            return false;
        }
        var postBody = new BookData { Id = bookingid };
        var bookingdata = await Http.PostAsJsonAsync("api/appointment/GetAppointmentDataForBooking", postBody);
        string apiResponse = await bookingdata.Content.ReadAsStringAsync();
        List<BookData> response = JsonConvert.DeserializeObject<List<BookData>>(apiResponse);
        if (response is null)
        {
            _isloader = false;
            NavigationManager.NavigateTo("errorpage?code=404");
        }
        if (response.Count > 0)
        {
            foreach (BookData data in response)
            {
                if (data.callstatus == "Start Soon")
                {
                    _testroomName = "Meeting For " + data.AppointmentDate + " - [ " + data.scheduleTime + " ] ";
                    if (usertype == "provider")
                    {
                        string newavtar = "";
                        string[] sname = data.ServiceProvider.Split(' ');

                        if (sname.Length == 1)
                        {
                            newavtar = sname[0].Substring(0, 2);
                        }
                        else if (sname.Length == 2)
                        {
                            newavtar = sname[0].Substring(0, 1) + sname[1].Substring(0, 1);
                        }
                        else if (sname.Length == 3)
                        {
                            newavtar = sname[0].Substring(0, 1) + sname[2].Substring(0, 1);
                        }

                        _username = data.ServiceProvider;
                        _serviceforname = newavtar.ToUpper();
                    }
                    else
                    {
                        string newavtar = "";
                        string[] sname = data.ServiceReceiver.Split(' ');

                        if (sname.Length == 1)
                        {
                            newavtar = sname[0].Substring(0, 2);
                        }
                        else if (sname.Length == 2)
                        {
                            newavtar = sname[0].Substring(0, 1) + sname[1].Substring(0, 1);
                        }
                        else if (sname.Length == 3)
                        {
                            newavtar = sname[0].Substring(0, 1) + sname[2].Substring(0, 1);
                        }
                        _username = data.ServiceProvider;
                        _serviceforname = newavtar.ToUpper();
                    }
                }
                else if (data.callstatus == "TimeOut")
                {
                    NavigationManager.NavigateTo("errorpage?code=505");
                }
                else if (data.callstatus == "Completed")
                {
                    NavigationManager.NavigateTo("errorpage?code=507");
                }
                else if (data.callstatus == "Yet to Start")
                {
                    NavigationManager.NavigateTo("errorpage?code=506");
                }
            }
            _isloader = false;
        }
        else
        {
            _isloader = false;
            NavigationManager.NavigateTo("errorpage?code=404");
        }

        return true;


    }




    protected async ValueTask<bool> TryJoinRoom(string? roomName, string? _serviceforname, string? _username)
    {
        if (roomName is null || roomName is { Length: 0 })
        {
            return false;
        }

        var jwt = await Http.GetFromJsonAsync<TwilioJwt>("api/twilio/token");
        if (jwt?.Token is null)
        {
            return false;
        }

        var joined = await JavaScript.CreateOrJoinRoomAsync(roomName, jwt.Token, _serviceforname, _username);
        if (joined)
        {
            _activeRoom = roomName;


        }

        return joined;
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavManager { get; set; }
    }
}
#pragma warning restore 1591
